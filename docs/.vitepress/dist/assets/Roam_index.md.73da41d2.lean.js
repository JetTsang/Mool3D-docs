var t=Object.defineProperty,e=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,a=(t,e)=>{for(var s in e||(e={}))i.call(e,s)&&r(t,s,e[s]);if(n)for(var s of n(e))o.call(e,s)&&r(t,s,e[s]);return t};import{V as c,ad as l,at as d,aD as p,aE as h,aF as u,aG as f,au as y,X as m,ap as g,aH as x,a7 as w,aI as b,y as P,M as v,_ as B,a4 as A,aJ as T,aK as S,a0 as M,aL as V,aM as F,aN as z,aO as U,$ as I,aP as R,aQ as k,aR as j,aS as E,aT as O,F as C,B as _,ak as D,C as H,aU as q,aV as W,aW as G,G as L,A as X,aj as K,p as N,a as Y,d as Z,r as $,b as J,e as Q,w as tt,f as et,o as st,c as nt,h as it,i as ot,v as rt,u as at,g as ct,t as lt,aX as dt,j as pt,k as ht}from"./app.ceccd6b0.js";import{V as ut,b as ft}from"./index.e1633dd4.js";const yt=Math.pow(2,-24);class mt{constructor(){}}function gt(t,e,s){return s.min.x=e[t],s.min.y=e[t+1],s.min.z=e[t+2],s.max.x=e[t+3],s.max.y=e[t+4],s.max.z=e[t+5],s}function xt(t){let e=-1,s=-1/0;for(let n=0;n<3;n++){const i=t[n+3]-t[n];i>s&&(s=i,e=n)}return e}function wt(t,e){e.set(t)}function bt(t,e,s){let n,i;for(let o=0;o<3;o++){const r=o+3;n=t[o],i=e[o],s[o]=n<i?n:i,n=t[r],i=e[r],s[r]=n>i?n:i}}function Pt(t,e,s){for(let n=0;n<3;n++){const i=e[t+2*n],o=e[t+2*n+1],r=i-o,a=i+o;r<s[n]&&(s[n]=r),a>s[n+3]&&(s[n+3]=a)}}function vt(t){const e=t[3]-t[0],s=t[4]-t[1],n=t[5]-t[2];return 2*(e*s+s*n+n*e)}function Bt(t,e,s,n,i=null){let o=1/0,r=1/0,a=1/0,c=-1/0,l=-1/0,d=-1/0,p=1/0,h=1/0,u=1/0,f=-1/0,y=-1/0,m=-1/0;const g=null!==i;for(let x=6*e,w=6*(e+s);x<w;x+=6){const e=t[x+0],s=t[x+1],n=e-s,i=e+s;n<o&&(o=n),i>c&&(c=i),g&&e<p&&(p=e),g&&e>f&&(f=e);const w=t[x+2],b=t[x+3],P=w-b,v=w+b;P<r&&(r=P),v>l&&(l=v),g&&w<h&&(h=w),g&&w>y&&(y=w);const B=t[x+4],A=t[x+5],T=B-A,S=B+A;T<a&&(a=T),S>d&&(d=S),g&&B<u&&(u=B),g&&B>m&&(m=B)}n[0]=o,n[1]=r,n[2]=a,n[3]=c,n[4]=l,n[5]=d,g&&(i[0]=p,i[1]=h,i[2]=u,i[3]=f,i[4]=y,i[5]=m)}const At=(t,e)=>t.candidate-e.candidate,Tt=new Array(32).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),St=new Float32Array(6);function Mt(t,e){function s(t){h&&h(t/u)}function n(e,i,h,u=null,y=0){if(!f&&y>=c&&(f=!0,l&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),h<=d||y>=c)return s(i+h),e.offset=i,e.count=h,e;const m=function(t,e,s,n,i,o){let r=-1,a=0;if(0===o)r=xt(e),-1!==r&&(a=(e[r]+e[r+3])/2);else if(1===o)r=xt(t),-1!==r&&(a=function(t,e,s,n){let i=0;for(let o=e,r=e+s;o<r;o++)i+=t[6*o+2*n];return i/s}(s,n,i,r));else if(2===o){const o=vt(t);let c=1.25*i;const l=6*n,d=6*(n+i);for(let t=0;t<3;t++){const n=e[t],p=(e[t+3]-n)/32;if(i<8){const e=[...Tt];e.length=i;let n=0;for(let i=l;i<d;i+=6,n++){const o=e[n];o.candidate=s[i+2*t],o.count=0;const{bounds:r,leftCacheBounds:a,rightCacheBounds:c}=o;for(let t=0;t<3;t++)c[t]=1/0,c[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,r[t]=1/0,r[t+3]=-1/0;Pt(i,s,r)}e.sort(At);let p=i;for(let t=0;t<p;t++){const s=e[t];for(;t+1<p&&e[t+1].candidate===s.candidate;)e.splice(t+1,1),p--}for(let i=l;i<d;i+=6){const n=s[i+2*t];for(let t=0;t<p;t++){const o=e[t];n>=o.candidate?Pt(i,s,o.rightCacheBounds):(Pt(i,s,o.leftCacheBounds),o.count++)}}for(let s=0;s<p;s++){const n=e[s],l=n.count,d=i-n.count,p=n.leftCacheBounds,h=n.rightCacheBounds;let u=0;0!==l&&(u=vt(p)/o);let f=0;0!==d&&(f=vt(h)/o);const y=1+1.25*(u*l+f*d);y<c&&(r=t,c=y,a=n.candidate)}}else{for(let t=0;t<32;t++){const e=Tt[t];e.count=0,e.candidate=n+p+t*p;const s=e.bounds;for(let t=0;t<3;t++)s[t]=1/0,s[t+3]=-1/0}for(let i=l;i<d;i+=6){let e=~~((s[i+2*t]-n)/p);e>=32&&(e=31);const o=Tt[e];o.count++,Pt(i,s,o.bounds)}const e=Tt[31];wt(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){const e=Tt[t],s=Tt[t+1];bt(e.bounds,s.rightCacheBounds,e.rightCacheBounds)}let h=0;for(let s=0;s<31;s++){const e=Tt[s],n=e.count,l=e.bounds,d=Tt[s+1].rightCacheBounds;0!==n&&(0===h?wt(l,St):bt(l,St,St)),h+=n;let p=0,u=0;0!==h&&(p=vt(St)/o);const f=i-h;0!==f&&(u=vt(d)/o);const y=1+1.25*(p*h+u*f);y<c&&(r=t,c=y,a=e.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:r,pos:a}}(e.boundingData,u,r,i,h,p);if(-1===m.axis)return s(i+h),e.offset=i,e.count=h,e;const g=function(t,e,s,n,i){let o=s,r=s+n-1;const a=i.pos,c=2*i.axis;for(;;){for(;o<=r&&e[6*o+c]<a;)o++;for(;o<=r&&e[6*r+c]>=a;)r--;if(!(o<r))return o;for(let s=0;s<3;s++){let n=t[3*o+s];t[3*o+s]=t[3*r+s],t[3*r+s]=n;let i=e[6*o+2*s+0];e[6*o+2*s+0]=e[6*r+2*s+0],e[6*r+2*s+0]=i;let a=e[6*o+2*s+1];e[6*o+2*s+1]=e[6*r+2*s+1],e[6*r+2*s+1]=a}o++,r--}}(a,r,i,h,m);if(g===i||g===i+h)s(i+h),e.offset=i,e.count=h;else{e.splitAxis=m.axis;const t=new mt,s=i,a=g-i;e.left=t,t.boundingData=new Float32Array(6),Bt(r,s,a,t.boundingData,o),n(t,s,a,o,y+1);const c=new mt,l=g,d=h-a;e.right=c,c.boundingData=new Float32Array(6),Bt(r,l,d,c.boundingData,o),n(c,l,d,o,y+1)}return e}!function(t,e){if(!t.index){const s=t.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let i;i=s>65535?new Uint32Array(new n(4*s)):new Uint16Array(new n(2*s)),t.setIndex(new x(i,1));for(let t=0;t<s;t++)i[t]=t}}(t,e);const i=new Float32Array(6),o=new Float32Array(6),r=function(t,e){const s=t.attributes.position,n=s.array,i=t.index.array,o=i.length/3,r=new Float32Array(6*o),a=s.offset||0;let c=3;s.isInterleavedBufferAttribute&&(c=s.data.stride);for(let l=0;l<o;l++){const t=3*l,s=6*l,o=i[t+0]*c+a,d=i[t+1]*c+a,p=i[t+2]*c+a;for(let i=0;i<3;i++){const t=n[o+i],a=n[d+i],c=n[p+i];let l=t;a<l&&(l=a),c<l&&(l=c);let h=t;a>h&&(h=a),c>h&&(h=c);const u=(h-l)/2,f=2*i;r[s+f+0]=l+u,r[s+f+1]=u+(Math.abs(l)+u)*yt,l<e[i]&&(e[i]=l),h>e[i+3]&&(e[i+3]=h)}}return r}(t,i),a=t.index.array,c=e.maxDepth,l=e.verbose,d=e.maxLeafTris,p=e.strategy,h=e.onProgress,u=t.index.count/3;let f=!1;const y=[],m=function(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];const e=[],s=new Set;for(const i of t.groups)s.add(i.start),s.add(i.start+i.count);const n=Array.from(s.values()).sort(((t,e)=>t-e));for(let i=0;i<n.length-1;i++){const t=n[i],s=n[i+1];e.push({offset:t/3,count:(s-t)/3})}return e}(t);if(1===m.length){const t=m[0],e=new mt;e.boundingData=i,function(t,e,s,n){let i=1/0,o=1/0,r=1/0,a=-1/0,c=-1/0,l=-1/0;for(let d=6*e,p=6*(e+s);d<p;d+=6){const e=t[d+0];e<i&&(i=e),e>a&&(a=e);const s=t[d+2];s<o&&(o=s),s>c&&(c=s);const n=t[d+4];n<r&&(r=n),n>l&&(l=n)}n[0]=i,n[1]=o,n[2]=r,n[3]=a,n[4]=c,n[5]=l}(r,t.offset,t.count,o),n(e,t.offset,t.count,o),y.push(e)}else for(let g of m){const t=new mt;t.boundingData=new Float32Array(6),Bt(r,g.offset,g.count,t.boundingData,o),n(t,g.offset,g.count,o),y.push(t)}return y}class Vt{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,n=-1/0;for(let i=0,o=t.length;i<o;i++){const o=t[i][e];s=o<s?o:s,n=o>n?o:n}this.min=s,this.max=n}setFromPoints(t,e){let s=1/0,n=-1/0;for(let i=0,o=e.length;i<o;i++){const o=e[i],r=t.dot(o);s=r<s?r:s,n=r>n?r:n}this.min=s,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}}Vt.prototype.setFromBox=function(){const t=new c;return function(e,s){const n=s.min,i=s.max;let o=1/0,r=-1/0;for(let a=0;a<=1;a++)for(let s=0;s<=1;s++)for(let c=0;c<=1;c++){t.x=n.x*a+i.x*(1-a),t.y=n.y*s+i.y*(1-s),t.z=n.z*c+i.z*(1-c);const l=e.dot(t);o=Math.min(l,o),r=Math.max(l,r)}this.min=o,this.max=r}}(),function(){const t=new Vt}();const Ft=function(){const t=new c,e=new c,s=new c;return function(n,i,o){const r=n.start,a=t,c=i.start,l=e;s.subVectors(r,c),t.subVectors(n.end,i.start),e.subVectors(i.end,i.start);const d=s.dot(l),p=l.dot(a),h=l.dot(l),u=s.dot(a),f=a.dot(a)*h-p*p;let y,m;y=0!==f?(d*p-u*h)/f:0,m=(d+y*p)/h,o.x=y,o.y=m}}(),zt=function(){const t=new l,e=new c,s=new c;return function(n,i,o,r){Ft(n,i,t);let a=t.x,c=t.y;if(a>=0&&a<=1&&c>=0&&c<=1)return n.at(a,o),void i.at(c,r);if(a>=0&&a<=1)return c<0?i.at(0,r):i.at(1,r),void n.closestPointToPoint(r,!0,o);if(c>=0&&c<=1)return a<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,r);{let t,l;t=a<0?n.start:n.end,l=c<0?i.start:i.end;const d=e,p=s;return n.closestPointToPoint(l,!0,e),i.closestPointToPoint(t,!0,s),d.distanceToSquared(l)<=p.distanceToSquared(t)?(o.copy(d),void r.copy(l)):(o.copy(t),void r.copy(p))}}}(),Ut=function(){const t=new c,e=new c,s=new d,n=new p;return function(i,o){const{radius:r,center:a}=i,{a:c,b:l,c:d}=o;n.start=c,n.end=l;if(n.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;n.start=c,n.end=d;if(n.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;n.start=l,n.end=d;if(n.closestPointToPoint(a,!0,t).distanceTo(a)<=r)return!0;const p=o.getPlane(s);if(Math.abs(p.distanceToPoint(a))<=r){const t=p.projectPoint(a,e);if(o.containsPoint(t))return!0}return!1}}();class It extends h{constructor(...t){super(...t),this.isSeparatingAxisTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new c)),this.satBounds=new Array(4).fill().map((()=>new Vt)),this.points=[this.a,this.b,this.c],this.sphere=new u,this.plane=new d,this.needsUpdate=!1}intersectsSphere(t){return Ut(t,this)}update(){const t=this.a,e=this.b,s=this.c,n=this.points,i=this.satAxes,o=this.satBounds,r=i[0],a=o[0];this.getNormal(r),a.setFromPoints(r,n);const c=i[1],l=o[1];c.subVectors(t,e),l.setFromPoints(c,n);const d=i[2],p=o[2];d.subVectors(e,s),p.setFromPoints(d,n);const h=i[3],u=o[3];h.subVectors(s,t),u.setFromPoints(h,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(r,t),this.needsUpdate=!1}}It.prototype.closestPointToSegment=function(){const t=new c,e=new c,s=new p;return function(n,i=null,o=null){const{start:r,end:a}=n,c=this.points;let l,d=1/0;for(let p=0;p<3;p++){const r=(p+1)%3;s.start.copy(c[p]),s.end.copy(c[r]),zt(s,n,t,e),l=t.distanceToSquared(e),l<d&&(d=l,i&&i.copy(t),o&&o.copy(e))}return this.closestPointToPoint(r,t),l=r.distanceToSquared(t),l<d&&(d=l,i&&i.copy(t),o&&o.copy(r)),this.closestPointToPoint(a,t),l=a.distanceToSquared(t),l<d&&(d=l,i&&i.copy(t),o&&o.copy(a)),Math.sqrt(d)}}(),It.prototype.intersectsTriangle=function(){const t=new It,e=new Array(3),s=new Array(3),n=new Vt,i=new Vt,o=new c,r=new c,a=new c,l=new c,d=new p,h=new p,u=new p;return function(c,p=null){this.needsUpdate&&this.update(),c.isSeparatingAxisTriangle?c.needsUpdate&&c.update():(t.copy(c),t.update(),c=t);const f=this.satBounds,y=this.satAxes;s[0]=c.a,s[1]=c.b,s[2]=c.c;for(let t=0;t<4;t++){const e=f[t],i=y[t];if(n.setFromPoints(i,s),e.isSeparated(n))return!1}const m=c.satBounds,g=c.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const s=m[t],i=g[t];if(n.setFromPoints(i,e),s.isSeparated(n))return!1}for(let t=0;t<4;t++){const r=y[t];for(let t=0;t<4;t++){const a=g[t];if(o.crossVectors(r,a),n.setFromPoints(o,e),i.setFromPoints(o,s),n.isSeparated(i))return!1}}if(p){const t=this.plane,e=c.plane;if(Math.abs(t.normal.dot(e.normal))>1-1e-10)console.warn("SeparatingAxisTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0);else{const s=this.points;let n=!1;for(let t=0;t<3;t++){const i=s[t],o=s[(t+1)%3];if(d.start.copy(i),d.end.copy(o),e.intersectLine(d,n?h.start:h.end)){if(n)break;n=!0}}const i=c.points;let o=!1;for(let e=0;e<3;e++){const s=i[e],n=i[(e+1)%3];if(d.start.copy(s),d.end.copy(n),t.intersectLine(d,o?u.start:u.end)){if(o)break;o=!0}}if(h.delta(r),u.delta(a),r.dot(a)<0){let t=u.start;u.start=u.end,u.end=t}l.subVectors(h.start,u.start),l.dot(r)>0?p.start.copy(h.start):p.start.copy(u.start),l.subVectors(h.end,u.end),l.dot(r)<0?p.end.copy(h.end):p.end.copy(u.end)}}return!0}}(),It.prototype.distanceToPoint=function(){const t=new c;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),It.prototype.distanceToTriangle=function(){const t=new c,e=new c,s=["a","b","c"],n=new p,i=new p;return function(o,r=null,a=null){const c=r||a?n:null;if(this.intersectsTriangle(o,c))return(r||a)&&(r&&c.getCenter(r),a&&c.getCenter(a)),0;let l=1/0;for(let e=0;e<3;e++){let n;const i=s[e],c=o[i];this.closestPointToPoint(c,t),n=c.distanceToSquared(t),n<l&&(l=n,r&&r.copy(t),a&&a.copy(c));const d=this[i];o.closestPointToPoint(d,t),n=d.distanceToSquared(t),n<l&&(l=n,r&&r.copy(d),a&&a.copy(t))}for(let d=0;d<3;d++){const c=s[d],p=s[(d+1)%3];n.set(this[c],this[p]);for(let d=0;d<3;d++){const c=s[d],p=s[(d+1)%3];i.set(o[c],o[p]),zt(n,i,t,e);const h=t.distanceToSquared(e);h<l&&(l=h,r&&r.copy(t),a&&a.copy(e))}}return Math.sqrt(l)}}();class Rt extends f{constructor(...t){super(...t),this.isOrientedBox=!0,this.matrix=new y,this.invMatrix=new y,this.points=new Array(8).fill().map((()=>new c)),this.satAxes=new Array(3).fill().map((()=>new c)),this.satBounds=new Array(3).fill().map((()=>new Vt)),this.alignedSatBounds=new Array(3).fill().map((()=>new Vt)),this.needsUpdate=!1}set(t,e,s){super.set(t,e),this.matrix=s,this.needsUpdate=!0}copy(t){super.copy(t),this.matrix.copy(t.matrix),this.needsUpdate=!0}}Rt.prototype.update=function(){const t=this.matrix,e=this.min,s=this.max,n=this.points;for(let c=0;c<=1;c++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const r=n[1*c|2*i|4*o];r.x=c?s.x:e.x,r.y=i?s.y:e.y,r.z=o?s.z:e.z,r.applyMatrix4(t)}const i=this.satBounds,o=this.satAxes,r=n[0];for(let c=0;c<3;c++){const t=o[c],e=i[c],s=n[1<<c];t.subVectors(r,s),e.setFromPoints(t,n)}const a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Rt.prototype.intersectsBox=function(){const t=new Vt;return function(e){this.needsUpdate&&this.update();const s=e.min,n=e.max,i=this.satBounds,o=this.satAxes,r=this.alignedSatBounds;if(t.min=s.x,t.max=n.x,r[0].isSeparated(t))return!1;if(t.min=s.y,t.max=n.y,r[1].isSeparated(t))return!1;if(t.min=s.z,t.max=n.z,r[2].isSeparated(t))return!1;for(let a=0;a<3;a++){const s=o[a],n=i[a];if(t.setFromBox(s,e),n.isSeparated(t))return!1}return!0}}(),Rt.prototype.intersectsTriangle=function(){const t=new It,e=new Array(3),s=new Vt,n=new Vt,i=new c;return function(o){this.needsUpdate&&this.update(),o.isSeparatingAxisTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const r=this.satBounds,a=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let t=0;t<3;t++){const n=r[t],i=a[t];if(s.setFromPoints(i,e),n.isSeparated(s))return!1}const c=o.satBounds,l=o.satAxes,d=this.points;for(let t=0;t<3;t++){const e=c[t],n=l[t];if(s.setFromPoints(n,d),e.isSeparated(s))return!1}for(let t=0;t<3;t++){const o=a[t];for(let t=0;t<4;t++){const r=l[t];if(i.crossVectors(o,r),s.setFromPoints(i,e),n.setFromPoints(i,d),s.isSeparated(n))return!1}}return!0}}(),Rt.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},Rt.prototype.distanceToPoint=function(){const t=new c;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),Rt.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new p)),s=new Array(12).fill().map((()=>new p)),n=new c,i=new c;return function(o,r=0,a=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(a||c)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),a&&a.copy(n),c&&c.copy(i)),0;const l=r*r,d=o.min,p=o.max,h=this.points;let u=1/0;for(let t=0;t<8;t++){const e=h[t];i.copy(e).clamp(d,p);const s=e.distanceToSquared(i);if(s<u&&(u=s,a&&a.copy(e),c&&c.copy(i),s<l))return Math.sqrt(s)}let f=0;for(let n=0;n<3;n++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){const r=(n+1)%3,a=(n+2)%3,c=1<<n|i<<r|o<<a,l=h[i<<r|o<<a],u=h[c];e[f].set(l,u);const y=t[n],m=t[r],g=t[a],x=s[f],w=x.start,b=x.end;w[y]=d[y],w[m]=i?d[m]:p[m],w[g]=o?d[g]:p[m],b[y]=p[y],b[m]=i?d[m]:p[m],b[g]=o?d[g]:p[m],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){i.x=t?p.x:d.x,i.y=e?p.y:d.y,i.z=s?p.z:d.z,this.closestPointToPoint(i,n);const o=i.distanceToSquared(n);if(o<u&&(u=o,a&&a.copy(n),c&&c.copy(i),o<l))return Math.sqrt(o)}for(let t=0;t<12;t++){const o=e[t];for(let t=0;t<12;t++){const e=s[t];zt(o,e,n,i);const r=n.distanceToSquared(i);if(r<u&&(u=r,a&&a.copy(n),c&&c.copy(i),r<l))return Math.sqrt(r)}}return Math.sqrt(u)}}();const kt=new c,jt=new c,Et=new c,Ot=new l,Ct=new l,_t=new l,Dt=new c;function Ht(t,e,s,n,i,o,r){kt.fromBufferAttribute(e,n),jt.fromBufferAttribute(e,i),Et.fromBufferAttribute(e,o);const a=function(t,e,s,n,i,o){let r;return r=o===_?t.intersectTriangle(n,s,e,!0,i):t.intersectTriangle(e,s,n,o!==D,i),null===r?null:{distance:t.origin.distanceTo(i),point:i.clone()}}(t,kt,jt,Et,Dt,r);if(a){s&&(Ot.fromBufferAttribute(s,n),Ct.fromBufferAttribute(s,i),_t.fromBufferAttribute(s,o),a.uv=h.getUV(Dt,kt,jt,Et,Ot,Ct,_t,new l));const t={a:n,b:i,c:o,normal:new c,materialIndex:0};h.getNormal(kt,jt,Et,t.normal),a.face=t,a.faceIndex=n}return a}function qt(t,e,s,n,i){const o=3*n,r=t.index.getX(o),a=t.index.getX(o+1),c=t.index.getX(o+2),l=Ht(s,t.attributes.position,t.attributes.uv,r,a,c,e);return l?(l.faceIndex=n,i&&i.push(l),l):null}function Wt(t,e,s){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(s.ray.origin),t.object=e,t.distance<s.near||t.distance>s.far?null:t)}function Gt(t,e,s,n){const i=t.a,o=t.b,r=t.c;let a=e,c=e+1,l=e+2;s&&(a=s.getX(e),c=s.getX(e+1),l=s.getX(e+2)),i.x=n.getX(a),i.y=n.getY(a),i.z=n.getZ(a),o.x=n.getX(c),o.y=n.getY(c),o.z=n.getZ(c),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l)}function Lt(t,e,s,n,i,o,r){const a=s.index,c=s.attributes.position;for(let l=t,d=e+t;l<d;l++)if(Gt(r,3*l,a,c),r.needsUpdate=!0,n(r,l,i,o))return!0;return!1}class Xt{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}function Kt(t,e){return 65535===e[t+15]}function Nt(t,e){return e[t+6]}function Yt(t,e){return e[t+14]}function Zt(t){return t+8}function $t(t,e){return e[t+6]}const Jt=new f,Qt=new c,te=["x","y","z"];function ee(t,e,s,n,i){let o=2*t,r=ce,a=le,c=de;if(Kt(o,a)){!function(t,e,s,n,i,o){for(let r=n,a=n+i;r<a;r++)qt(t,e,s,r,o)}(e,s,n,Nt(t,c),Yt(o,a),i)}else{const o=Zt(t);oe(o,r,n,Qt)&&ee(o,e,s,n,i);const a=$t(t,c);oe(a,r,n,Qt)&&ee(a,e,s,n,i)}}function se(t,e,s,n){let i=2*t,o=ce,r=le,a=de;if(Kt(i,r)){return function(t,e,s,n,i){let o=1/0,r=null;for(let a=n,c=n+i;a<c;a++){const n=qt(t,e,s,a);n&&n.distance<o&&(r=n,o=n.distance)}return r}(e,s,n,Nt(t,a),Yt(i,r))}{const i=function(t,e){return e[t+7]}(t,a),r=te[i],c=n.direction[r]>=0;let l,d;c?(l=Zt(t),d=$t(t,a)):(l=$t(t,a),d=Zt(t));const p=oe(l,o,n,Qt)?se(l,e,s,n):null;if(p){const t=p.point[r];if(c?t<=o[d+i]:t>=o[d+i+3])return p}const h=oe(d,o,n,Qt)?se(d,e,s,n):null;return p&&h?p.distance<=h.distance?p:h:p||h||null}}const ne=function(){let t,e;const s=[],n=new Xt((()=>new f));return function(...o){t=n.getPrimitive(),e=n.getPrimitive(),s.push(t,e);const r=i(...o);n.releasePrimitive(t),n.releasePrimitive(e),s.pop(),s.pop();const a=s.length;return a>0&&(e=s[a-1],t=s[a-2]),r};function i(s,n,o,r,a=null,c=0,l=0){function d(t){let e=2*t,s=le,n=de;for(;!Kt(e,s);)e=2*(t=Zt(t));return Nt(t,n)}function p(t){let e=2*t,s=le,n=de;for(;!Kt(e,s);)e=2*(t=$t(t,n));return Nt(t,n)+Yt(e,s)}let h=2*s,u=ce,f=le,y=de;if(Kt(h,f)){const e=Nt(s,y),n=Yt(h,f);return gt(s,u,t),r(e,n,!1,l,c+s,t)}{const h=Zt(s),m=$t(s,y);let g,x,w,b,P=h,v=m;if(a&&(w=t,b=e,gt(P,u,w),gt(v,u,b),g=a(w),x=a(b),x<g)){P=m,v=h;const t=g;g=x,x=t,w=b}w||(w=t,gt(P,u,w));const B=o(w,Kt(2*P,f),g,l+1,c+P);let A;if(2===B){const t=d(P);A=r(t,p(P)-t,!0,l+1,c+P,w)}else A=B&&i(P,n,o,r,a,c,l+1);if(A)return!0;b=e,gt(v,u,b);const T=o(b,Kt(2*v,f),x,l+1,c+v);let S;if(2===T){const t=d(v);S=r(t,p(v)-t,!0,l+1,c+v,b)}else S=T&&i(v,n,o,r,a,c,l+1);return!!S}}}(),ie=function(){const t=new It,e=new It,s=new y,n=new Rt,i=new Rt;return function o(r,a,c,l,d=null){let p=2*r,h=ce,u=le,f=de;null===d&&(c.boundingBox||c.computeBoundingBox(),n.set(c.boundingBox.min,c.boundingBox.max,l),d=n);if(!Kt(p,u)){const t=r+8,e=f[r+6];gt(t,h,Jt);if(d.intersectsBox(Jt)&&o(t,a,c,l,d))return!0;gt(e,h,Jt);return!!(d.intersectsBox(Jt)&&o(e,a,c,l,d))}{const n=a,o=n.index,d=n.attributes.position,y=c.index,m=c.attributes.position,g=Nt(r,f),x=Yt(p,u);if(s.copy(l).invert(),c.boundsTree){gt(r,h,i),i.matrix.copy(s),i.needsUpdate=!0;return c.boundsTree.shapecast({intersectsBounds:t=>i.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(l),t.b.applyMatrix4(l),t.c.applyMatrix4(l),t.needsUpdate=!0;for(let s=3*g,n=3*(x+g);s<n;s+=3)if(Gt(e,s,o,d),e.needsUpdate=!0,t.intersectsTriangle(e))return!0;return!1}})}for(let i=3*g,r=x+3*g;i<r;i+=3){Gt(t,i,o,d),t.a.applyMatrix4(s),t.b.applyMatrix4(s),t.c.applyMatrix4(s),t.needsUpdate=!0;for(let s=0,n=y.count;s<n;s+=3)if(Gt(e,s,y,m),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}}}();function oe(t,e,s,n){return gt(t,e,Jt),s.intersectBox(Jt,n)}const re=[];let ae,ce,le,de;function pe(t){ae&&re.push(ae),ae=t,ce=new Float32Array(t),le=new Uint16Array(t),de=new Uint32Array(t)}function he(){ae=null,ce=null,le=null,de=null,re.length&&pe(re.pop())}const ue=Symbol("skip tree generation"),fe=new f,ye=new f,me=new y,ge=new Rt,xe=new Rt,we=new c,be=new c,Pe=new c,ve=new c,Be=new c,Ae=new f,Te=new Xt((()=>new It));class Se{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Se.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});e=a({cloneBuffers:!0},e);const s=t.geometry,n=t._roots,i=s.getIndex();let o;return o=e.cloneBuffers?{roots:n.map((t=>t.slice())),index:i.array.slice()}:{roots:n,index:i.array},o}static deserialize(t,n,i={}){if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Se.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i=a({setIndex:!0},i);const{index:o,roots:r}=t,c=new Se(n,(l=a({},i),e(l,s({[ue]:!0}))));var l;if(c._roots=r,i.setIndex){const e=n.getIndex();if(null===e){const e=new x(t.index,1,!1);n.setIndex(e)}else e.array!==o&&(e.array.set(o),e.needsUpdate=!0)}return c}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[ue]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[ue]||(this._roots=function(t,e){const s=Mt(t,e);let n,i,o;const r=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<s.length;d++){const t=s[d],e=new a(32*c(t));n=new Float32Array(e),i=new Uint32Array(e),o=new Uint16Array(e),l(0,t),r.push(e)}return r;function c(t){return t.count?1:1+c(t.left)+c(t.right)}function l(t,e){const s=t/4,r=t/2,a=!!e.count,c=e.boundingData;for(let i=0;i<6;i++)n[s+i]=c[i];if(a){const n=e.offset,a=e.count;return i[s+6]=n,o[r+14]=a,o[r+15]=65535,t+32}{const n=e.left,o=e.right,r=e.splitAxis;let a;if(a=l(t+32,n),a/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[s+6]=a/4,a=l(a,o),i[s+7]=r,a}}}(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new f))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=this.geometry,s=e.index.array,n=e.attributes.position,i=n.array,o=n.offset||0;let r,a,c,l,d=3;n.isInterleavedBufferAttribute&&(d=n.data.stride);let p=0;const h=this._roots;for(let f=0,y=h.length;f<y;f++)r=h[f],a=new Uint32Array(r),c=new Uint16Array(r),l=new Float32Array(r),u(0,p),p+=r.byteLength;function u(e,n,r=!1){const p=2*e;if(65535===c[p+15]){const t=a[e+6];let n=1/0,r=1/0,h=1/0,u=-1/0,f=-1/0,y=-1/0;for(let e=3*t,a=3*(t+c[p+14]);e<a;e++){const t=s[e]*d+o,a=i[t+0],c=i[t+1],l=i[t+2];a<n&&(n=a),a>u&&(u=a),c<r&&(r=c),c>f&&(f=c),l<h&&(h=l),l>y&&(y=l)}return(l[e+0]!==n||l[e+1]!==r||l[e+2]!==h||l[e+3]!==u||l[e+4]!==f||l[e+5]!==y)&&(l[e+0]=n,l[e+1]=r,l[e+2]=h,l[e+3]=u,l[e+4]=f,l[e+5]=y,!0)}{const s=e+8,i=a[e+6],o=s+n,c=i+n;let d=r,p=!1,h=!1;t?d||(p=t.has(o),h=t.has(c),d=!p&&!h):(p=!0,h=!0);const f=d||h;let y=!1;(d||p)&&(y=u(s,n,d));let m=!1;f&&(m=u(i,n,d));const g=y||m;if(g)for(let t=0;t<3;t++){const n=s+t,o=i+t,r=l[n],a=l[n+3],c=l[o],d=l[o+3];l[e+t]=r<c?r:c,l[e+t+3]=a>d?a:d}return g}}}traverse(t,e=0){const s=this._roots[e],n=new Uint32Array(s),i=new Uint16Array(s);!function e(o,r=0){const a=2*o,c=65535===i[a+15];if(c){const e=n[o+6],l=i[a+14];t(r,c,new Float32Array(s,4*o,6),e,l)}else{const i=o+8,a=n[o+6],l=n[o+7];t(r,c,new Float32Array(s,4*o,6),l)||(e(i,r+1),e(a,r+1))}}(0)}raycast(t,e=C){const s=this._roots,n=this.geometry,i=[],o=e.isMaterial,r=Array.isArray(e),a=n.groups,c=o?e.side:e;for(let l=0,d=s.length;l<d;l++){const o=r?e[a[l].materialIndex].side:c,d=i.length;if(pe(s[l]),ee(0,n,o,t,i),he(),r){const t=a[l].materialIndex;for(let e=d,s=i.length;e<s;e++)i[e].face.materialIndex=t}}return i}raycastFirst(t,e=C){const s=this._roots,n=this.geometry,i=e.isMaterial,o=Array.isArray(e);let r=null;const a=n.groups,c=i?e.side:e;for(let l=0,d=s.length;l<d;l++){const i=o?e[a[l].materialIndex].side:c;pe(s[l]);const d=se(0,n,i,t);he(),null!=d&&(null==r||d.distance<r.distance)&&(r=d,o&&(d.face.materialIndex=a[l].materialIndex))}return r}intersectsGeometry(t,e){const s=this.geometry;let n=!1;for(const i of this._roots)if(pe(i),n=ie(0,s,t,e),he(),n)break;return n}shapecast(t,e,s){const n=this.geometry;if(t instanceof Function){if(e){const t=e;e=(e,s,n,i)=>{const o=3*s;return t(e,o,o+1,o+2,n,i)}}t={boundsTraverseOrder:s,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const i=Te.getPrimitive();let{boundsTraverseOrder:o,intersectsBounds:r,intersectsRange:a,intersectsTriangle:c}=t;if(a&&c){const t=a;a=(e,s,o,r,a)=>!!t(e,s,o,r,a)||Lt(e,s,n,c,o,r,i)}else a||(a=c?(t,e,s,o)=>Lt(t,e,n,c,s,o,i):(t,e,s)=>s);let l=!1,d=0;for(const p of this._roots){if(pe(p),l=ne(0,n,r,a,o,d),he(),l)break;d+=p.byteLength}return Te.releasePrimitive(i),l}bvhcast(t,e,s){let{intersectsRanges:n,intersectsTriangles:i}=s;const o=this.geometry.index,r=this.geometry.attributes.position,a=t.geometry.index,c=t.geometry.attributes.position;me.copy(e).invert();const l=Te.getPrimitive(),d=Te.getPrimitive();if(i){let t=function(t,s,n,p,h,u,f,y){for(let m=n,g=n+p;m<g;m++){Gt(d,3*m,a,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let e=t,n=t+s;e<n;e++)if(Gt(l,3*e,o,r),l.needsUpdate=!0,i(l,d,e,m,h,u,f,y))return!0}return!1};if(n){const e=n;n=function(s,n,i,o,r,a,c,l){return!!e(s,n,i,o,r,a,c,l)||t(s,n,i,o,r,a,c,l)}}else n=t}this.getBoundingBox(ye),ye.applyMatrix4(e);const p=this.shapecast({intersectsBounds:t=>ye.intersectsBox(t),intersectsRange:(e,s,i,o,r,a)=>(fe.copy(a),fe.applyMatrix4(me),t.shapecast({intersectsBounds:t=>fe.intersectsBox(t),intersectsRange:(t,i,a,c,l)=>n(e,s,t,i,o,r,c,l)}))});return Te.releasePrimitive(l),Te.releasePrimitive(d),p}intersectsBox(t,e){return ge.set(t.min,t.max,e),ge.needsUpdate=!0,this.shapecast({intersectsBounds:t=>ge.intersectsBox(t),intersectsTriangle:t=>ge.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},n={},i=0,o=1/0){t.boundingBox||t.computeBoundingBox(),ge.set(t.boundingBox.min,t.boundingBox.max,e),ge.needsUpdate=!0;const r=this.geometry,a=r.attributes.position,c=r.index,l=t.attributes.position,d=t.index,p=Te.getPrimitive(),h=Te.getPrimitive();let u=be,f=Pe,y=null,m=null;n&&(y=ve,m=Be);let g=1/0,x=null,w=null;return me.copy(e).invert(),xe.matrix.copy(me),this.shapecast({boundsTraverseOrder:t=>ge.distanceToBox(t,Math.min(g,o)),intersectsBounds:(t,e,s)=>s<g&&s<o&&(e&&(xe.min.copy(t.min),xe.max.copy(t.max),xe.needsUpdate=!0),!0),intersectsRange:(s,n)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:t=>xe.distanceToBox(t,Math.min(g,o)),intersectsBounds:(t,e,s)=>s<g&&s<o,intersectsRange:(t,o)=>{for(let r=3*t,b=3*(t+o);r<b;r+=3){Gt(h,r,d,l),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let t=3*s,e=3*(s+n);t<e;t+=3){Gt(p,t,c,a),p.needsUpdate=!0;const e=p.distanceToTriangle(h,u,y);if(e<g&&(f.copy(u),m&&m.copy(y),g=e,x=t/3,w=r/3),e<i)return!0}}}});for(let t=0,o=d?d.count:l.count;t<o;t+=3){Gt(h,t,d,l),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let e=3*s,o=3*(s+n);e<o;e+=3){Gt(p,e,c,a),p.needsUpdate=!0;const s=p.distanceToTriangle(h,u,y);if(s<g&&(f.copy(u),m&&m.copy(y),g=s,x=e/3,w=t/3),s<i)return!0}}}}),Te.releasePrimitive(p),Te.releasePrimitive(h),g===1/0?null:(s.point?s.point.copy(f):s.point=f.clone(),s.distance=g,s.faceIndex=x,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(me),f.applyMatrix4(me),n.distance=f.sub(n.point).length(),n.faceIndex=w),s)}closestPointToPoint(t,e={},s=0,n=1/0){const i=s*s,o=n*n;let r=1/0,a=null;if(this.shapecast({boundsTraverseOrder:e=>(we.copy(t).clamp(e.min,e.max),we.distanceToSquared(t)),intersectsBounds:(t,e,s)=>s<r&&s<o,intersectsTriangle:(e,s)=>{e.closestPointToPoint(t,we);const n=t.distanceToSquared(we);return n<r&&(be.copy(we),r=n,a=s),n<i}}),r===1/0)return null;const c=Math.sqrt(r);return e.point?e.point.copy(be):e.point=be.clone(),e.distance=c,e.faceIndex=a,e}getBoundingBox(t){t.makeEmpty();return this._roots.forEach((e=>{gt(0,new Float32Array(e),Ae),t.union(Ae)})),t}}const Me=Se.prototype.raycast;Se.prototype.raycast=function(...t){if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,s,n,i]=t;return Me.call(this,n,e.material).forEach((t=>{(t=Wt(t,e,s))&&i.push(t)})),i}return Me.apply(this,t)};const Ve=Se.prototype.raycastFirst;Se.prototype.raycastFirst=function(...t){if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,s,n]=t;return Wt(Ve.call(this,n,e.material),e,s)}return Ve.apply(this,t)};const Fe=Se.prototype.closestPointToPoint;Se.prototype.closestPointToPoint=function(...t){if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),t.unshift();const e=t[1],s={};return t[1]=s,Fe.apply(this,t),e&&e.copy(s.point),s.distance}return Fe.apply(this,t)};const ze=Se.prototype.closestPointToGeometry;Se.prototype.closestPointToGeometry=function(...t){const e=t[2],s=t[3];if(e&&e.isVector3||s&&s.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const n={},i={},o=t[1];return t[2]=n,t[3]=i,ze.apply(this,t),e&&e.copy(n.point),s&&s.copy(i.point).applyMatrix4(o),n.distance}return ze.apply(this,t)};const Ue=Se.prototype.refit;Se.prototype.refit=function(...t){const e=t[0],s=t[1];if(s&&(s instanceof Set||Array.isArray(s))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const t=new Set;s.forEach((e=>t.add(e))),e&&e.forEach((e=>t.add(e))),Ue.call(this,t)}else Ue.apply(this,t)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach((t=>{const e=Se.prototype[t];Se.prototype[t]=function(...s){return(null===s[0]||s[0].isMesh)&&(s.shift(),console.warn(`MeshBVH: The function signature for "${t}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,s)}}));const Ie=new f;class Re extends m{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(t,e,s=10,n=0){super(),this.material=e,this.geometry=new g,this.name="MeshBVHRootVisualizer",this.depth=s,this.displayParents=!1,this.mesh=t,this.displayEdges=!0,this._group=n}raycast(){}update(){const t=this.geometry,e=this.mesh.geometry.boundsTree,s=this._group;if(t.dispose(),this.visible=!1,e){const n=this.depth-1,i=this.displayParents;let o=0;e.traverse(((t,e)=>{if(t===n||e)return o++,!0;i&&o++}),s);let r=0;const a=new Float32Array(24*o);let c,l;e.traverse(((t,e,s)=>{const o=t===n||e;if(o||i){gt(0,s,Ie);const{min:t,max:e}=Ie;for(let s=-1;s<=1;s+=2){const n=s<0?t.x:e.x;for(let s=-1;s<=1;s+=2){const i=s<0?t.y:e.y;for(let s=-1;s<=1;s+=2){const o=s<0?t.z:e.z;a[r+0]=n,a[r+1]=i,a[r+2]=o,r+=3}}}return o}}),s),l=this.displayEdges?new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),c=a.length>65535?new Uint32Array(l.length*o):new Uint16Array(l.length*o);const d=l.length;for(let t=0;t<o;t++){const e=8*t,s=t*d;for(let t=0;t<d;t++)c[s+t]=e+l[t]}t.setIndex(new x(c,1,!1)),t.setAttribute("position",new x(a,3,!1)),this.visible=!0}}}class ke extends w{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(t){this.edgeMaterial.opacity=t,this.meshMaterial.opacity=t}constructor(t,e=10){super(),this.name="MeshBVHVisualizer",this.depth=e,this.mesh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];const s=new b({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),n=new P({color:65416,transparent:!0,opacity:.3,depthWrite:!1});n.color=s.color,this.edgeMaterial=s,this.meshMaterial=n,this.update()}update(){const t=this.mesh.geometry.boundsTree,e=t?t._roots.length:0;for(;this._roots.length>e;)this._roots.pop();for(let s=0;s<e;s++){if(s>=this._roots.length){const t=new Re(this.mesh,this.edgeMaterial,this.depth,s);this.add(t),this._roots.push(t)}const t=this._roots[s];t.depth=this.depth,t.mesh=this.mesh,t.displayParents=this.displayParents,t.displayEdges=this.displayEdges,t.material=this.displayEdges?this.edgeMaterial:this.meshMaterial,t.update()}}updateMatrixWorld(...t){this.position.copy(this.mesh.position),this.rotation.copy(this.mesh.rotation),this.scale.copy(this.mesh.scale),super.updateMatrixWorld(...t)}copy(t){this.depth=t.depth,this.mesh=t.mesh}clone(){return new ke(this.mesh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const t=this.children;for(let e=0,s=t.length;e<s;e++)t[e].geometry.dispose()}}v.prototype.raycast;class je{constructor(t){this.collider=null,this.visualizer=null,this.player=null,this.controls=t.controls,this.object=null,this.environment=null,this.scene=t.scene,this.camera=t.camera,this.animate=t.animate,this.modelPath=t.modelPath,this.playerIsOnGround=!1,this.fwdPressed=!1,this.bkdPressed=!1,this.lftPressed=!1,this.rgtPressed=!1,this.playerVelocity=new c,this.upVector=new c(0,1,0),this.tempVector=new c,this.tempVector2=new c,this.tempBox=new f,this.tempMat=new y,this.tempSegment=new p,this.clock=new H,this.isRun=!1,this.angle=0,this.params={firstPerson:!1,displayCollider:!1,displayBVH:!1,visualizeDepth:10,gravity:-2,playerSpeed:.3,physicsSteps:12,playerVelocity:5,reset:this.reset}}init(){this.loadColliderEnvironment(),this.windowEvent(),this.animate.push((()=>{this.render()}))}loadColliderEnvironment(){(new f).setFromObject(this.scene),this.scene.updateMatrixWorld(!0);const t={};this.scene.traverse((e=>{if(e.isMesh&&void 0!==e.material.color){const s=e.material.color.getHex();t[s]=t[s]||[],t[s].push(e)}})),this.environment=new w;for(const n in t){const e=t[n],s=[];if(e.forEach((t=>{if(t.material.emissive)this.environment.attach(t);else{const e=t.geometry.clone();console.log(e),e.applyMatrix4(t.matrixWorld),!e.attributes.uv2&&e.index&&s.push(e)}})),s.length>0){const t=q(s),e=new v(t,new W({color:parseInt(n)}));e.material.transparent=!0,e.material.opacity=0,e.name="mool",this.environment.add(e)}}const e=[];this.environment.updateMatrixWorld(!0),this.environment.traverse((t=>{if(t.geometry){const s=t.geometry.clone();s.applyMatrix4(t.matrixWorld);for(const t in s.attributes)"position"!==t&&s.deleteAttribute(t);e.push(s)}}));const s=q(e,!1);s.boundsTree=new Se(s,{lazyGeneration:!1}),this.collider=new v(s),this.collider.material.wireframe=!0,this.collider.material.opacity=.5,this.collider.material.transparent=!0,this.visualizer=new ke(this.collider,this.params.visualizeDepth),this.scene.add(this.visualizer),this.scene.add(this.collider),this.scene.add(this.environment),this.loadplayer()}loadplayer(){this.player=new v(new G(.5,1.5,.5,17,.5),new W),this.player.geometry.translate(0,-.5,0),this.player.capsuleInfo={radius:.7,segment:new p(new c,new c(0,-1,0))},this.player.name="player",this.player.castShadow=!0,this.player.receiveShadow=!0,this.player.material.shadowSide=2,this.player.visible=!1;(new L).load(this.modelPath,(t=>{t.scene.scale.set(3,3,3),this.object=t.scene,this.object.castShadow=!0,this.object.receiveShadow=!0,this.object.visible=!0,this.object.traverse((t=>{t.castShadow=!0})),this.animations=t.animations,this.mixer=new X(t.scene),this.mixer.clipAction(this.animations[1]).play(),this.scene.add(this.player,this.object),this.reset()}))}debounce(t,e){return function(){}}windowEvent(){const t=this;document.addEventListener("keydown",(function(e){switch(e.code){case"KeyW":t.fwdPressed=!0;break;case"KeyS":t.bkdPressed=!0;break;case"KeyD":t.rgtPressed=!0;break;case"KeyA":t.lftPressed=!0;break;case"KeyZ":t.playerIsOnGround&&(t.playerVelocity.y=t.params.playerVelocity);break;case"ShiftLeft":t.params.playerSpeed=.6,t.params.playerVelocity=7;break;case"KeyV":t.params.firstPerson=!t.params.firstPerson,t.params.firstPerson?t.object.visible=!1:(t.camera.position.sub(t.controls.target).normalize().multiplyScalar(10).add(t.controls.target),t.camera.updateMatrixWorld(),t.object.visible=!0)}t.isRun||(t.mixer.stopAllAction(),t.mixer.clipAction(t.animations[0]).play(),t.isRun=!0)})),document.addEventListener("keyup",(function(e){switch(e.code){case"KeyW":t.fwdPressed=!1;break;case"KeyS":t.bkdPressed=!1;break;case"KeyD":t.rgtPressed=!1;break;case"KeyA":t.lftPressed=!1;break;case"ShiftLeft":t.params.playerSpeed=.3,t.params.playerVelocity=5}!t.isRun||t.fwdPressed||t.bkdPressed||t.rgtPressed||t.lftPressed||(t.mixer.stopAllAction(),t.mixer.clipAction(t.animations[1]).play(),t.isRun=!1)}))}reset(){this.playerVelocity.set(0,0,0),this.player.position.set(0,20,50),this.camera.position.sub(this.controls.target),this.controls.target.copy(this.player.position),this.camera.position.add(this.player.position),this.controls.update()}render(){const t=Math.min(this.clock.getDelta(),.1);if(this.mixer&&this.mixer.update(t),this.mixer&&(this.rgtPressed||this.lftPressed||this.bkdPressed||this.fwdPressed)&&this.params.firstPerson,this.params.firstPerson?(this.controls.maxPolarAngle=Math.PI/2,this.controls.minDistance=1e-4,this.controls.maxDistance=1e-4):(this.controls.maxPolarAngle=Math.PI/2,this.controls.minDistance=5,this.controls.maxDistance=10),this.collider&&this.player){this.collider.visible=this.params.displayCollider,this.visualizer.visible=this.params.displayBVH;const e=this.params.physicsSteps;for(let s=0;s<e;s++)this.updatePlayer(t)}}updatePlayer(t){this.playerVelocity.y+=this.playerIsOnGround?0:t*this.params.gravity,this.player.position.addScaledVector(this.playerVelocity,t);const e=this.controls.getAzimuthalAngle();this.fwdPressed&&(this.tempVector.set(0,0,-1).applyAxisAngle(this.upVector,this.angle+e),this.player.position.addScaledVector(this.tempVector,this.params.playerSpeed*t)),this.bkdPressed&&(this.tempVector.set(0,0,1).applyAxisAngle(this.upVector,e),this.player.position.addScaledVector(this.tempVector,this.params.playerSpeed*t)),this.lftPressed&&(this.tempVector.set(-1,0,0).applyAxisAngle(this.upVector,e),this.player.position.addScaledVector(this.tempVector,this.params.playerSpeed*t)),this.rgtPressed&&(this.tempVector.set(1,0,0).applyAxisAngle(this.upVector,e),this.player.position.addScaledVector(this.tempVector,this.params.playerSpeed*t)),this.player.updateMatrixWorld();const s=this.player.capsuleInfo;this.tempBox.makeEmpty(),this.tempMat.copy(this.collider.matrixWorld).invert(),this.tempSegment.copy(s.segment),this.tempSegment.start.applyMatrix4(this.player.matrixWorld).applyMatrix4(this.tempMat),this.tempSegment.end.applyMatrix4(this.player.matrixWorld).applyMatrix4(this.tempMat),this.tempBox.expandByPoint(this.tempSegment.start),this.tempBox.expandByPoint(this.tempSegment.end),this.tempBox.min.addScalar(-s.radius),this.tempBox.max.addScalar(s.radius),this.collider.geometry.boundsTree.shapecast({intersectsBounds:t=>t.intersectsBox(this.tempBox),intersectsTriangle:t=>{const e=this.tempVector,n=this.tempVector2,i=t.closestPointToSegment(this.tempSegment,e,n);if(i<s.radius){const t=s.radius-i,o=n.sub(e).normalize();this.tempSegment.start.addScaledVector(o,t),this.tempSegment.end.addScaledVector(o,t)}}});const n=this.tempVector;n.copy(this.tempSegment.start).applyMatrix4(this.collider.matrixWorld);const i=this.tempVector2;i.subVectors(n,this.player.position),this.playerIsOnGround=i.y>Math.abs(t*this.playerVelocity.y*.25);const o=Math.max(0,i.length()-1e-5);i.normalize().multiplyScalar(o),this.player.position.add(i),this.playerIsOnGround?this.playerVelocity.set(0,0,0):(i.normalize(),this.playerVelocity.addScaledVector(i,-i.dot(this.playerVelocity))),this.camera.position.sub(this.controls.target),this.controls.target.copy(this.player.position),this.camera.position.add(this.player.position),this.camera.updateMatrixWorld(),this.player.rotation.y=this.controls.getAzimuthalAngle()+3+this.angle,this.object&&(this.object.rotation.y=this.controls.getAzimuthalAngle()+3+this.angle,this.object.position.set(this.player.position.clone().x,this.player.position.clone().y,this.player.position.clone().z),this.object.position.y-=1.5),this.player.position.y<-25&&this.reset()}}class Ee extends ut{constructor(t){super(t),this.initModel()}init(){this.initSource(),this.initSky(),this.model.playAllClipes(8),this.sky.initShaderSky({scale:1e4,turbidity:1,rayleigh:10,postion:[15,6,-20]}),this.particle=this.initParticleEngine(this.particle,!0),this.fish(),this.roam()}fish(){var t;null==(t=this.ambient)||t.setLight(1,.7),this.particle.destroy(),this.setParticleMode(this.particle,"fireflies",{positionBase:new c(50,50,-50),positionSpread:new c(200,-200,200),sizeBase:10,particlesPerSecond:5,particleDeathAge:10,particleTexture:this.souce.loadTexture({path:"/docs/public/images/fish.png"})})}setLight(){this.initDirectional("#fff",1),this.directional.light.position.set(10,100,10),this.directional.light.shadow.bias=-5e-4,this.directional.light.shadow.mapSize.x=8192,this.directional.light.shadow.mapSize.y=8192}roam(){this.Roam=new je({scene:this.gScenes[this.sceneidx],camera:this.activeCamera,animate:this.animate.animateFuntion,controls:this.controls.orbitControls,renderer:this.renderer,modelPath:"../public/scene/glb/run.glb"}),this.Roam.init(),this.setLight()}setAngle(t){this.Roam.angle=-t,this.Roam.fwdPressed=!0,this.Roam.isRun||(this.Roam.mixer.stopAllAction(),this.Roam.mixer.clipAction(this.Roam.animations[0]).play(),this.Roam.isRun=!0)}end(){this.Roam.fwdPressed=!1,this.Roam.isRun&&(this.Roam.mixer.stopAllAction(),this.Roam.mixer.clipAction(this.Roam.animations[1]).play(),this.Roam.isRun=!1)}jump(){this.Roam.playerIsOnGround&&(this.Roam.playerVelocity.y=this.Roam.params.playerVelocity)}super(){5==this.Roam.params.playerSpeed?(this.Roam.params.playerSpeed=.3,this.Roam.params.playerVelocity=5,this.Roam.object.traverse((t=>{t.material&&(t.material=this.oldMater)}))):(this.Roam.object.traverse((t=>{t.material&&(this.oldMater=t.material.clone(),t.material.map=this.souce.loadTexture({path:"/docs/public/images/super.png",onLoad:function(t){t.wrapS=t.wrapT=K,t.rotation=1.5}}))})),this.Roam.params.playerSpeed=5,this.Roam.params.playerVelocity=20)}}N("data-v-40f1d8c8");const Oe={class:"loading"},Ce=pt('<div class="loading-text" data-v-40f1d8c8><span class="loading-text-words" data-v-40f1d8c8>L</span><span class="loading-text-words" data-v-40f1d8c8>O</span><span class="loading-text-words" data-v-40f1d8c8>A</span><span class="loading-text-words" data-v-40f1d8c8>D</span><span class="loading-text-words" data-v-40f1d8c8>I</span><span class="loading-text-words" data-v-40f1d8c8>N</span><span class="loading-text-words" data-v-40f1d8c8>G</span></div>',1),_e={class:"loding-percent"},De={class:"container"},He={class:"container-text"};Y();var qe=Z({props:{sceneId:{type:String,default:"0"},visible:{type:Boolean,default:!1}},setup(t){const e=t,s=$();let n,i=$(!0),o=$(!1),r=$(""),a=$("0"),c=$([78,400]),l=$([78,400]),d=$(!1),p=$(!1);J((()=>{h(),p.value=!u()})),Q((()=>{n&&n.destroy(),ft.off("scene")})),ft.on("scene",(t=>{({loading:()=>{a.value=t.progressNum,i.value=t.value},transition:()=>{o.value=t.value}})[t.type]()})),tt((()=>a),(t=>{ft.emit("progressNum",at(t)),parseInt(at(t))>=100&&setTimeout((()=>{i.value=!1,o.value=!0,setTimeout((()=>{o.value=!1}),1500)}),1e3)}),{deep:!0}),tt((()=>e.sceneId),(()=>{}),{deep:!0,immediate:!0});const h=()=>{const t=s.value;n=new Ee({el:t,tween:et,path:"../public/scene/"}),b(4)},u=()=>{for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,n=0;n<e.length;n++)if(t.indexOf(e[n])>0){s=!1;break}return s},f=t=>{console.log(t)},y=t=>{if(t.preventDefault(),t.touches.length>1)return;let e=w({x:0,y:0-at(c)[1]},{x:t.touches[0].clientX-at(c)[0],y:t.touches[0].clientY-at(c)[1]});t.touches[0].clientY<340||t.touches[0].clientX>125||(l.value=[t.touches[0].clientX-at(c)[0]+50,t.touches[0].clientY-at(c)[1]+50],n.setAngle(e))},m=()=>{n.end()},g=()=>{n.jump()},x=()=>{d.value=!at(d),n.super()},w=({x:t,y:e},{x:s,y:n})=>{const i=t*s+e*n,o=t*n-e*s;return Math.atan2(o,i)},b=t=>{switch(t){case 4:n.setScene(8,(()=>{n.init()})),r.value="漫游",n.flyTo({position:[0,6,5],controls:[0,0,0],duration:2e3})}};return(t,e)=>(st(),nt("div",{class:"wrap",onTouchmove:e[1]||(e[1]=dt((()=>{}),["prevent"]))},[it("    loding"),ot(ct("div",Oe,[Ce,ct("div",_e,lt(parseInt(at(a)))+"%",1)],512),[[rt,at(i)]]),it("转场动画"),ot(ct("div",De,[ct("span",He,lt(at(r)),1)],512),[[rt,at(o)]]),ct("div",{ref:s,id:"map",class:"map"},null,512),at(p)?(st(),nt("div",{key:0,class:"rocking",onTouchstart:f,onTouchmove:dt(y,["stop"]),onTouchend:dt(m,["stop"])},[ct("div",{class:"hand",style:{left:at(l)[0]+"px",top:at(l)[1]+"px"}},null,4)],40,["onTouchmove","onTouchend"])):it("v-if",!0),at(p)?(st(),nt("div",{key:1,class:"jump",onTouchstart:dt(g,["stop"])},"跳跃",40,["onTouchstart"])):it("v-if",!0),at(p)?(st(),nt("div",{key:2,class:[at(d)?"super":"super1"],onTouchstart:dt(x,["stop"])}," 超能力 ",42,["onTouchstart"])):it("v-if",!0),at(p)?it("v-if",!0):(st(),nt("div",{key:3,class:[at(d)?"super":"super1"],onClick:dt(x,["stop"])}," 超能力 ",10,["onClick"]))],32))}});qe.__scopeId="data-v-40f1d8c8";const We=ct("h1",{id:"漫游"},[ct("a",{class:"header-anchor",href:"#漫游","aria-hidden":"true"},"#"),ht(" 漫游")],-1),Ge='{"title":"漫游","description":"","frontmatter":{},"relativePath":"Roam/index.md","lastUpdated":1679552049273}',Le={};const Xe=Object.assign(Le,{setup:function(t){return(t,e)=>(st(),nt("div",null,[We,ct(qe)]))}});export default Xe;export{Ge as __pageData};
