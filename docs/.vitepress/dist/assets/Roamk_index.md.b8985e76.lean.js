import{V as a,A as t,al as s,p as e,b as i,d as o,r as n,e as l,f as r,w as c,g as h,o as p,c as d,h as m,i as u,v,u as y,j as b,t as g,aE as x,a as f,k as w}from"./app.fee60d13.js";import{V as R,b as A}from"./index.207465f4.js";import{R as S}from"./sceneRoam.7f8ca2a2.js";class T extends R{constructor(a){super(a),this.initModel()}init(){this.initSource(),this.initSky(),this.model.playAllClipes(8),this.sky.initShaderSky({scale:1e4,turbidity:1,rayleigh:10,postion:[15,6,-20]}),this.particle=this.initParticleEngine(this.particle,!0),this.fish(),this.loadPlayer()}fish(){var t;null==(t=this.ambient)||t.setLight(1,.7),this.particle.destroy(),this.setParticleMode(this.particle,"fireflies",{positionBase:new a(50,50,-50),positionSpread:new a(200,-200,200),sizeBase:10,particlesPerSecond:5,particleDeathAge:10,particleTexture:this.souce.loadTexture({path:"/docs/public/images/fish.png"})})}setLight(){this.initDirectional("#fff",1),this.directional.light.position.set(10,100,10),this.directional.light.shadow.bias=-5e-4,this.directional.light.shadow.mapSize.x=8192,this.directional.light.shadow.mapSize.y=8192}loadPlayer(){this.model.loadModel("../public/scene/glb/run.glb",this.sceneidx,((a,s)=>{this.player=a,this.player.scale.set(3,3,3),this.player.castShadow=!0,this.player.receiveShadow=!0,this.player.visible=!0,this.player.traverse((a=>{a.castShadow=!0})),this.animations=s,this.mixer=new t(a),this.mixer.clipAction(this.animations[1]).play(),this.animate.animateFuntion.push((a=>{this.mixer&&this.mixer.update(a)})),this.roam()}))}runCallback(a){a?(this.mixer.stopAllAction(),this.mixer.clipAction(this.animations[0]).play()):(this.mixer.stopAllAction(),this.mixer.clipAction(this.animations[1]).play())}roam(){this.Roam=new S({scene:this.gScenes[this.sceneidx],camera:this.activeCamera,animate:this.animate.animateFuntion,controls:this.controls.orbitControls,renderer:this.renderer,object:this.player,runCallback:this.runCallback.bind(this)}),this.Roam.init(),this.setLight()}setAngle(a){this.Roam.angle=-a,this.Roam.fwdPressed=!0,this.Roam.isRun||(this.mixer.stopAllAction(),this.mixer.clipAction(this.animations[0]).play(),this.Roam.isRun=!0)}end(){this.Roam.fwdPressed=!1,this.Roam.isRun&&(this.mixer.stopAllAction(),this.mixer.clipAction(this.animations[1]).play(),this.Roam.isRun=!1)}jump(){this.Roam.playerIsOnGround&&(this.Roam.playerVelocity.y=this.Roam.params.playerVelocity)}super(){5==this.Roam.params.playerSpeed?(this.Roam.params.playerSpeed=.3,this.Roam.params.playerVelocity=5,this.Roam.object.traverse((a=>{a.material&&(a.material=this.oldMater)}))):(this.Roam.object.traverse((a=>{a.material&&(this.oldMater=a.material.clone(),a.material.map=this.souce.loadTexture({path:"/docs/public/images/super.png",onLoad:function(a){a.wrapS=a.wrapT=s,a.rotation=1.5}}))})),this.Roam.params.playerSpeed=5,this.Roam.params.playerVelocity=20)}}e("data-v-4b73b0a5");const k={class:"loading"},P=f('<div class="loading-text" data-v-4b73b0a5><span class="loading-text-words" data-v-4b73b0a5>L</span><span class="loading-text-words" data-v-4b73b0a5>O</span><span class="loading-text-words" data-v-4b73b0a5>A</span><span class="loading-text-words" data-v-4b73b0a5>D</span><span class="loading-text-words" data-v-4b73b0a5>I</span><span class="loading-text-words" data-v-4b73b0a5>N</span><span class="loading-text-words" data-v-4b73b0a5>G</span></div>',1),j={class:"loding-percent"},C={class:"container"},I={class:"container-text"};i();var M=o({props:{sceneId:{type:String,default:"0"},visible:{type:Boolean,default:!1}},setup(a){const t=a,s=n();let e,i=n(!0),o=n(!1),f=n(""),w=n("0"),R=n([78,400]),S=n([78,400]),M=n(!1),V=n(!1);l((()=>{L(),V.value=!O()})),r((()=>{e&&e.destroy(),A.off("scene")})),A.on("scene",(a=>{({loading:()=>{w.value=a.progressNum,i.value=a.value},transition:()=>{o.value=a.value}})[a.type]()})),c((()=>w),(a=>{A.emit("progressNum",y(a)),parseInt(y(a))>=100&&setTimeout((()=>{i.value=!1,o.value=!0,setTimeout((()=>{o.value=!1}),1500)}),1e3)}),{deep:!0}),c((()=>t.sceneId),(()=>{}),{deep:!0,immediate:!0});const L=()=>{const a=s.value;e=new T({el:a,tween:h,path:"../public/scene/"}),E(4)},O=()=>{for(var a=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,e=0;e<t.length;e++)if(a.indexOf(t[e])>0){s=!1;break}return s},D=a=>{console.log(a)},z=a=>{if(a.preventDefault(),a.touches.length>1)return;let t=Y({x:0,y:0-y(R)[1]},{x:a.touches[0].clientX-y(R)[0],y:a.touches[0].clientY-y(R)[1]});a.touches[0].clientY<340||a.touches[0].clientX>125||(S.value=[a.touches[0].clientX-y(R)[0]+50,a.touches[0].clientY-y(R)[1]+50],e.setAngle(t))},B=()=>{e.end()},N=()=>{e.jump()},X=()=>{M.value=!y(M),e.super()},Y=({x:a,y:t},{x:s,y:e})=>{const i=a*s+t*e,o=a*e-t*s;return Math.atan2(o,i)},E=a=>{switch(a){case 4:e.setScene(8,(()=>{e.init()})),f.value="漫游",e.flyTo({position:[0,6,5],controls:[0,0,0],duration:2e3})}};return(a,t)=>(p(),d("div",{class:"wrap",onTouchmove:t[1]||(t[1]=x((()=>{}),["prevent"]))},[m("    loding"),u(b("div",k,[P,b("div",j,g(parseInt(y(w)))+"%",1)],512),[[v,y(i)]]),m("转场动画"),u(b("div",C,[b("span",I,g(y(f)),1)],512),[[v,y(o)]]),b("div",{ref:s,id:"map",class:"map"},null,512),y(V)?(p(),d("div",{key:0,class:"rocking",onTouchstart:D,onTouchmove:x(z,["stop"]),onTouchend:x(B,["stop"])},[b("div",{class:"hand",style:{left:y(S)[0]+"px",top:y(S)[1]+"px"}},null,4)],40,["onTouchmove","onTouchend"])):m("v-if",!0),y(V)?(p(),d("div",{key:1,class:"jump",onTouchstart:x(N,["stop"])},"跳跃",40,["onTouchstart"])):m("v-if",!0),y(V)?(p(),d("div",{key:2,class:[y(M)?"super":"super1"],onTouchstart:x(X,["stop"])}," 超能力 ",42,["onTouchstart"])):m("v-if",!0),y(V)?m("v-if",!0):(p(),d("div",{key:3,class:[y(M)?"super":"super1"],onClick:x(X,["stop"])}," 超能力 ",10,["onClick"]))],32))}});M.__scopeId="data-v-4b73b0a5";const V=b("h1",{id:"漫游"},[b("a",{class:"header-anchor",href:"#漫游","aria-hidden":"true"},"#"),w(" 漫游")],-1),L='{"title":"漫游","description":"","frontmatter":{},"relativePath":"Roamk/index.md","lastUpdated":1679992843434}',O={};const D=Object.assign(O,{setup:function(a){return(a,t)=>(p(),d("div",null,[V,b(M)]))}});export default D;export{L as __pageData};
