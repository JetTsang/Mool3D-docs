import{A as t,p as s,b as a,d as e,r as i,e as o,f as n,w as r,g as l,o as c,c as h,h as d,i as p,v as u,u as m,j as v,t as g,aE as f,a as y,k as x}from"./app.fee60d13.js";import{V as b,b as R}from"./index.207465f4.js";import{R as w}from"./sceneRoam.7f8ca2a2.js";class k extends b{constructor(t){super(t),this.initModel(),this.stop=!1}init(){this.initSource(),this.initSky(),this.initEnvironment({path:"exr.exr",type:"exr"}),this.sky.initShaderSky({scale:1e4,turbidity:1,rayleigh:10,postion:[15,6,-20]}),this.loadPlayer()}setLight(){this.initDirectional("#fff",1),this.directional.light.position.set(10,100,10),this.directional.light.shadow.bias=-5e-4,this.directional.light.shadow.mapSize.x=8192,this.directional.light.shadow.mapSize.y=8192}loadPlayer(){this.model.loadModel("../public/scene/glb/walk.glb",this.sceneidx,((s,a)=>{this.player=s,this.player.scale.set(2.5,2.5,2.5),this.animations=a,this.mixer=new t(s),this.mixer.clipAction(this.animations[0]).play(),this.animate.animateFuntion.push((t=>{!this.stop&&this.mixer&&this.mixer.update(t)})),this.roam()}))}runCallback(t){t?(this.stop=!1,this.mixer.clipAction(this.animations[0]).play()):this.stop=!0}roam(){this.Roam=new w({scene:this.gScenes[this.sceneidx],camera:this.activeCamera,animate:this.animate.animateFuntion,controls:this.controls.orbitControls,renderer:this.renderer,object:this.player,runCallback:this.runCallback.bind(this)}),this.Roam.init(),this.setLight(),setTimeout((()=>{this.stop=!0}),1e3)}setAngle(t){this.Roam.angle=-t,this.Roam.fwdPressed=!0,this.Roam.isRun||(this.stop=!1,this.mixer.clipAction(this.animations[0]).play(),this.Roam.isRun=!0)}end(){this.Roam.fwdPressed=!1,this.Roam.isRun&&(this.stop=!0,this.Roam.isRun=!1)}jump(){this.Roam.playerIsOnGround&&(this.Roam.playerVelocity.y=this.Roam.params.playerVelocity)}first(){this.Roam.params.firstPerson=!this.Roam.params.firstPerson,this.Roam.params.firstPerson?(this.Roam.camera.updateMatrixWorld(),this.Roam.object.visible=!1,this.Roam.controls.reset()):(this.Roam.camera.position.sub(this.Roam.controls.target).normalize().multiplyScalar(5).add(this.Roam.controls.target),this.Roam.camera.updateMatrixWorld(),this.Roam.object.visible=!0)}}s("data-v-4be794a5");const T={class:"loading"},P=y('<div class="loading-text" data-v-4be794a5><span class="loading-text-words" data-v-4be794a5>L</span><span class="loading-text-words" data-v-4be794a5>O</span><span class="loading-text-words" data-v-4be794a5>A</span><span class="loading-text-words" data-v-4be794a5>D</span><span class="loading-text-words" data-v-4be794a5>I</span><span class="loading-text-words" data-v-4be794a5>N</span><span class="loading-text-words" data-v-4be794a5>G</span></div>',1),S={class:"loding-percent"},j={class:"container"},A={class:"container-text"};a();var C=e({props:{sceneId:{type:String,default:"0"},visible:{type:Boolean,default:!1}},setup(t){const s=t,a=i();let e,y=i(!0),x=i(!1),b=i(""),w=i("0"),C=i([78,400]),I=i([78,400]),M=i(!1),O=i(!1);o((()=>{z(),O.value=!D()})),n((()=>{e&&e.destroy(),R.off("scene")})),R.on("scene",(t=>{({loading:()=>{w.value=t.progressNum,y.value=t.value},transition:()=>{x.value=t.value}})[t.type]()})),r((()=>w),(t=>{R.emit("progressNum",m(t)),parseInt(m(t))>=100&&setTimeout((()=>{y.value=!1,x.value=!0,setTimeout((()=>{x.value=!1}),1500)}),1e3)}),{deep:!0}),r((()=>s.sceneId),(()=>{}),{deep:!0,immediate:!0});const z=()=>{const t=a.value;e=new k({el:t,tween:l,path:"../public/scene/"}),E(4)},D=()=>{for(var t=navigator.userAgent,s=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],a=!0,e=0;e<s.length;e++)if(t.indexOf(s[e])>0){a=!1;break}return a},L=t=>{console.log(t)},N=t=>{if(t.preventDefault(),t.touches.length>1)return;let s=Y({x:0,y:0-m(C)[1]},{x:t.touches[0].clientX-m(C)[0],y:t.touches[0].clientY-m(C)[1]});t.touches[0].clientY<340||t.touches[0].clientX>125||(I.value=[t.touches[0].clientX-m(C)[0]+50,t.touches[0].clientY-m(C)[1]+50],e.setAngle(s))},V=()=>{e.end()},W=()=>{e.jump()},X=()=>{M.value=!m(M),e.first()},Y=({x:t,y:s},{x:a,y:e})=>{const i=t*a+s*e,o=t*e-s*a;return Math.atan2(o,i)},E=t=>{switch(t){case 4:e.setScene(9,(()=>{setTimeout((()=>{e.init()}),1e3)})),b.value="仿真漫游",e.flyTo({position:[-5,3,2],controls:[0,0,0],duration:2e3})}};return(t,s)=>(c(),h("div",{class:"wrap",onTouchmove:s[1]||(s[1]=f((()=>{}),["prevent"]))},[d("    loding"),p(v("div",T,[P,v("div",S,g(parseInt(m(w)))+"%",1)],512),[[u,m(y)]]),d("转场动画"),p(v("div",j,[v("span",A,g(m(b)),1)],512),[[u,m(x)]]),v("div",{ref:a,id:"map",class:"map"},null,512),m(O)?(c(),h("div",{key:0,class:"rocking",onTouchstart:L,onTouchmove:f(N,["stop"]),onTouchend:f(V,["stop"])},[v("div",{class:"hand",style:{left:m(I)[0]+"px",top:m(I)[1]+"px"}},null,4)],40,["onTouchmove","onTouchend"])):d("v-if",!0),m(O)?(c(),h("div",{key:1,class:"jump",onTouchstart:f(W,["stop"])},"跳跃",40,["onTouchstart"])):d("v-if",!0),m(O)?(c(),h("div",{key:2,class:[m(M)?"super":"super1"],onTouchstart:f(X,["stop"])}," 视角 ",42,["onTouchstart"])):d("v-if",!0),m(O)?d("v-if",!0):(c(),h("div",{key:3,class:[m(M)?"super":"super1"],onClick:f(X,["stop"])}," 视角 ",10,["onClick"]))],32))}});C.__scopeId="data-v-4be794a5";const I=v("h1",{id:"仿真漫游"},[v("a",{class:"header-anchor",href:"#仿真漫游","aria-hidden":"true"},"#"),x(" 仿真漫游")],-1),M='{"title":"仿真漫游","description":"","frontmatter":{},"relativePath":"Roam/index.md","lastUpdated":1679992863383}',O={};const z=Object.assign(O,{setup:function(t){return(t,s)=>(c(),h("div",null,[I,v(C)]))}});export default z;export{M as __pageData};
